<%= render 'layouts/header' %>
<% if flash[:notice] %>
    <%= flash[:notice] %>
<% end %>
<div class="container">
	<div class="col-xs-3" style="padding: 0 15px;">
		<%= render 'users/user_info', user: @user,now: ''%>
		<%= render 'books/book_form', book: @book %>
	</div>
	<div class="col-xs-9">
		<h2 style="margin: 20 0 10px 0;">Books detail</h2>
		<table class="table">
			<tr>
				<!-- 画像リンクをつけたい -->
				<td>
					<div><a><%= attachment_image_tag @user, :profile_image, :fill, 100, 100, format: 'jpeg', fallback: "no_image.png" %></a>
					</div>
					<div>
						<%= link_to @user.name, user_path(@user)%>
					</div>
				</td>
				<td><%= link_to @book_show.title, book_path(@book_show) %></td>
				<td><%= @book_show.body %></td>
				<% if @book_show.favorited_by?(current_user) %>
					<td>
						<%= link_to favorite_path(@book_show), method: :delete do %>
							<span>❤️</span>
							<%= @book_show.favorites.count %>
						<% end %>
					</td>
				<% else %>
					<td>
						<%= link_to favorites_path(@book_show), method: :post do %>
							<span>♡</span>
							<%= @book_show.favorites.count %>
						<% end %>
					</td>
				<% end %>
				<% if current_user == @user %>
					<td><%= link_to "edit", edit_book_path %></td>
					<td><%= link_to "destroy", book_path, method: :delete %></td>
				<% end %>
				<td>
					コメント数 : <%= @book_show.book_comments.count %>
				</td>
			</tr>
		</table>
		<div class="col-xs-12">
			<div class="col-xs-6">
				<h3><strong>コメント一覧</strong></h3>
				<% @book_show.book_comments.each do |comments| %>
					<div style="border: 1px solid black; padding: 5px 10px;">
						<%= comments.comment %>
					</div>
					<% if current_user.id == comments.user_id %>
						<%= link_to "コメント削除", book_book_comment_path(@book_show,comments.id), method: :delete %>
					<% end %>
					<br>
					<br>
				<% end %>
			</div>
			<div class="col-xs-6">
				<h3><strong>コメントを投稿する</strong></h3>
				<%= form_for [@book_show, @book_comment] do |c| %>
					<%= c.text_area :comment, style: "width: 400px; height: 200px;" %>
					<%= c.submit "送信" %>
				<% end %>
			</div>
		</div>
	</div>
</div>
<%= render 'layouts/footer' %>
